function pluginPushAdunitForGptAdSlot(t,e,n,o){var i=getMatchSectionFromUri(getUri()),r=(ozoneLog("matchSection from uri is: "+i),e.getSlotElementId());if(getExcludeDivInSection(r,i))return ozoneLog("pluginPushAdunitForGptAdSlot will exclude the div from this section: "+r),0;ozoneLog("pluginPushAdunitForGptAdSlot received initialGptTargeting: ",n);var a=o.adunitCodeMatch;let s=r;if(a){s=a.replace("[div_id]",r);var g,a=simplifyGptTargeting(getPageTargeting()),u=simplifyGptTargeting(n),d=Object.assign(a,u),a=s.match(/\[[^\]]+\]/g)||[],u=(ozoneLog("found key placeholders in adunit name to match:",a),a.map(t=>t.replaceAll(/[\[\]]/g,"")));ozoneLog(`pluginPushAdunitForGptAdSlot Going to try to parse matchThis string: ${s} with object: `,d);for(g of u)s=s.replace(`[${g}]`,d[g]),ozoneLog("matchThis = "+s)}a=s.match(/^(.+?)_(.+)$/);if(a&&(u=a[2],-1===["0","1","2","3","4","5","6","7","8","9"].indexOf(u))&&(ozoneLog(`pluginPushAdunitForGptAdSlot Substituting catchall ${a[1]+"_ca"} for `+s),s=a[1]+"_ca"),ozoneLog("pluginPushAdunitForGptAdSlot Going to try to match adunit.codes to "+s),0===(u=window.ozAdUnits.filter(t=>t.code===s)).length)return ozoneLog("pluginPushAdunitForGptAdSlot failed to find any adunits matching element id: "+r),0;ozoneLog("pluginPushAdunitForGptAdSlot found matching adunits: ",u);var p=o.useDfpTargeting;let l;ozoneLog("pluginPushAdunitForGptAdSlot working with true/false/whitelist useDfpTargeting=",p);var c=getSecOrArt();if(!0===p){ozoneLog("pluginPushAdunitForGptAdSlot mapping all gpt page + slot targeting keys to adunit(s)"),l=getPageTargeting();for(var h of u){var f=h.bids.filter(t=>"ozone"===t.bidder),f=(f&&Array.isArray(f)&&0<f.length&&(f[0].params.hasOwnProperty("customData")||(f[0].params.customData=[{settings:{},targeting:{}}]),Object.assign(f[0].params.customData[0].targeting,simplifyGptTargeting(l)),Object.assign(f[0].params.customData[0].targeting,simplifyGptTargeting(n)),f[0].params.customData[0].targeting.cont_type=c,f[0].params.customData[0].targeting.section=i),JSON.parse(JSON.stringify(h)));f.code=r,tryUseSlotSizes(f,o,e),t.push(f)}}else if(Array.isArray(p)){ozoneLog("pluginPushAdunitForGptAdSlot apply whitelisted keys of gpt targeting to adunit(s)"),l=getPageTargeting(p);for(var m of u){for(var y of p)ozoneLog("pluginPushAdunitForGptAdSlot setting adunit page/slot targeting for key:"+y,l,n),l.hasOwnProperty(y)&&setAdunitOzoneTargeting(m,l,y),n.hasOwnProperty(y)&&setAdunitOzoneTargeting(m,n,y);setAdunitOzoneTargeting(m,{cont_type:c},"cont_type"),setAdunitOzoneTargeting(m,{section:i},"section");var A=JSON.parse(JSON.stringify(m));A.code=r,tryUseSlotSizes(A,o,e),t.push(A)}}else{ozoneLog("pluginPushAdunitForGptAdSlot don't push any dfp keys into targeting");for(var S of u){S=JSON.parse(JSON.stringify(S));S.code=r,tryUseSlotSizes(S,o,e),setAdunitOzoneTargeting(S,{cont_type:c},"cont_type"),setAdunitOzoneTargeting(S,{section:i},"section"),t.push(S)}}return o.addTestgroupKey&&addTestgroup(t,o.testgroupKeyName,o.testgroupVal),u.length}function getUri(){return document.location.pathname.replace("/ozone/20220606-bbc-wrapper/bbc_test","")}var adunitNameRegexMatches={sport:/^\/sport/,news_hub:/^\/news\/?$/,home:/^\/?$/,business:/^\/news\/business/,culture:/^\/culture/,entertainment:/^\/news\/entertainment(_and_arts|-arts)/,future:/^\/future/,sci_env:/^\/news\/science(_and_environment|-environment)/,technology:/^\/news\/technology/,travel:/^\/travel/,worklife:/^\/worklife/,weather:/^\/weather/,news_content:/^\/news\/.+$/};function getSecOrArt(){try{return"article"===JSON.parse(document.querySelector("#__NEXT_DATA__").innerText).props.pageProps.type?"art":"sec"}catch(t){return"undefined"}}function getMatchSectionFromUri(e){var n=Object.keys(this.adunitNameRegexMatches);for(let t=0;t<n.length;t++){var o=n[t],i=this.adunitNameRegexMatches[o];if(ozoneLog(`trying to match ${i} against ${e} - adunitNameFragment is `+o),e.match(i))return o}return"ros"}function getExcludeDivInSection(t,e){return"home"===e&&"dotcom-slot-top"===t}function tryUseSlotSizes(e,t,n){if(t.adunitsUseSlotSizes)try{e.mediaTypes.banner.sizes=ozMakeArrSizes(n.getSizes()),ozoneLog("Updated the adunit slot sizes to be what we found on googletag.pubads().getSlots() ... ",e.mediaTypes.banner.sizes)}catch(t){ozoneLog("Failed to update the adunit slot sizes to be what we found on googletag.pubads().getSlots() (possibly not a banner type?) ",e)}}function ozMakeArrSizes(e){var n=[];for(let t=0;t<e.length;t++)"object"==typeof e[t]&&e[t].width&&n.push([e[t].width,e[t].height]);return n}function addTestgroup(t,e,n){for(var o of t)setAdunitOzoneTargeting(o,{[e]:n},e)}function setAdunitOzoneTargeting(t,e,n){t=t.bids.filter(t=>"ozone"===t.bidder);t&&Array.isArray(t)&&0<t.length&&setAdunitCustomTargetingKey(t[0],n,e[n])}function setAdunitCustomTargetingKey(t,e,n){t.params.hasOwnProperty("customData")||(t.params.customData=[{settings:{},targeting:{}}]),t.params.customData[0].targeting[e]=Array.isArray(n)&&1===n.length?n[0]:n}function getPageTargeting(e){let n={};return e=e||googletag.pubads().getTargetingKeys(),googletag.pubads().getTargetingKeys().forEach(t=>{-1<e.indexOf(t)&&(n[t]=googletag.pubads().getTargeting(t))}),n}function simplifyGptTargeting(t){var e,n={};for(e of Object.keys(t))Array.isArray(t[e])&&1===t[e].length?n[e]=t[e][0]:n[e]=t[e];return n}ozoneLog("pluginPushAdunitForGptAdSlot 20230608 11:30 file is loaded");